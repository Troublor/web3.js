{"version":3,"sources":["webpack://@darcher/misc/../darcher-helpers-browser/dist/index.js","webpack://@darcher/misc/../darcher-helpers-browser/dist/log.js","webpack://@darcher/misc/../darcher-helpers-browser/dist/utility.js","webpack://@darcher/misc/./src/trace-instrument.ts","webpack://@darcher/misc/webpack/bootstrap","webpack://@darcher/misc/webpack/startup"],"names":["__createBinding","this","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__exportStar","exports","p","prototype","hasOwnProperty","call","value","Logger","module","level","parseLog","message","context","_a","now","Date","logTime","getMonth","toString","padStart","getDay","getHours","getMinutes","getSeconds","getMilliseconds","padEnd","slice","colored","payload","contextLiteral","key","Level","levelString","log","ERROR","console","error","WARN","warn","INFO","info","DEBUG","debug","lvl","prettifyHash","hash","startIndex","startsWith","substring","length","logger","oneTimeWebSocketRequest","url","data","Promise","resolve","reject","ws","WebSocket","onopen","send","JSON","stringify","onerror","ev","onmessage","msg","parse","close","traceSendAsync","method","callback","stack","Error","captureStackTrace","Proxy","apply","target","thisArg","argArray","trace","split","map","item","trim","filter","err","type","result","traceObj","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__"],"mappings":"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","file":"trace-instrument.js","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./log\"), exports);\n__exportStar(require(\"./utility\"), exports);\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Logger = void 0;\nvar Logger = /** @class */ (function () {\n    function Logger(module, level) {\n        this.module = module;\n        this.level = level;\n    }\n    Logger.prototype.parseLog = function (level, message, context) {\n        var _a;\n        var now = new Date();\n        var month = now.getMonth().toString().padStart(2, \"0\");\n        var day = now.getDay().toString().padStart(2, \"0\");\n        var hour = now.getHours().toString().padStart(2, \"0\");\n        var minute = now.getMinutes().toString().padStart(2, \"0\");\n        var second = now.getSeconds().toString().padStart(2, \"0\");\n        var millisecond = now.getMilliseconds().toString().padEnd(3, \"0\").slice(0, 3);\n        var logTime = month + \"-\" + day + \"|\" + hour + \":\" + minute + \":\" + second + \".\" + millisecond;\n        var colored = function (level, payload) {\n            // TODO coloring in Browser Console\n            return payload;\n        };\n        var contextLiteral = \"\";\n        if (context) {\n            for (var key in context) {\n                if (context.hasOwnProperty(key)) {\n                    // @ts-ignore\n                    contextLiteral += colored(level, key) + \"=\" + ((_a = context[key]) === null || _a === void 0 ? void 0 : _a.toString()) + \" \";\n                }\n            }\n        }\n        return colored(level, Logger.Level.levelString(level).padEnd(5, \" \")) + \"[\" + logTime + \"][\" + this.module + \"] \" + message.padEnd(48, \" \") + \" \" + contextLiteral;\n    };\n    Logger.prototype.log = function (level, message, context) {\n        if (this.level <= level) {\n            switch (this.level) {\n                case Logger.Level.ERROR:\n                    console.error(this.parseLog(level, message, context));\n                    break;\n                case Logger.Level.WARN:\n                    console.warn(this.parseLog(level, message, context));\n                    break;\n                case Logger.Level.INFO:\n                    console.info(this.parseLog(level, message, context));\n                    break;\n                case Logger.Level.DEBUG:\n                    console.debug(this.parseLog(level, message, context));\n                    break;\n                default:\n                    console.log(this.parseLog(level, message, context));\n            }\n        }\n    };\n    Logger.prototype.info = function (message, context) {\n        this.log(Logger.Level.INFO, message, context);\n    };\n    Logger.prototype.warn = function (message, context) {\n        this.log(Logger.Level.WARN, message, context);\n    };\n    Logger.prototype.debug = function (message, context) {\n        this.log(Logger.Level.DEBUG, message, context);\n    };\n    Logger.prototype.error = function (message, context) {\n        this.log(Logger.Level.ERROR, message, context);\n    };\n    Logger.Level = {\n        DEBUG: 1,\n        INFO: 2,\n        WARN: 3,\n        ERROR: 4,\n        levelString: function (lvl) {\n            switch (lvl) {\n                case 1:\n                    return 'DEBUG';\n                case 2:\n                    return 'INFO';\n                case 3:\n                    return 'WARN';\n                case 4:\n                    return 'ERROR';\n                default:\n                    return 'UNKNOWN';\n            }\n        }\n    };\n    return Logger;\n}());\nexports.Logger = Logger;\n//# sourceMappingURL=log.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.prettifyHash = void 0;\nfunction prettifyHash(hash) {\n    var startIndex = 0;\n    if (hash.startsWith(\"0x\")) {\n        startIndex = 2;\n    }\n    return hash.substring(startIndex, startIndex + 6) + \"\\u2026\" + hash.substring(hash.length - 6, hash.length);\n}\nexports.prettifyHash = prettifyHash;\n//# sourceMappingURL=utility.js.map","import {Logger, prettifyHash} from \"@darcher/helpers-browser\";\nimport {Data} from \"./metamask-notifier\";\n\nexport interface SendTransactionTrace {\n    hash: string,\n    stack: string[],\n}\n\nexport interface StackTraceMessage extends Data {\n    type: 'FetchStackTrace',\n    stack: string[],\n}\n\nconst logger = new Logger(\"Trace\", Logger.Level.INFO);\n\nasync function oneTimeWebSocketRequest<T extends Data>(url: string, data: T): Promise<T> {\n    return new Promise<T>((resolve, reject) => {\n        const ws = new WebSocket(url);\n        ws.onopen = () => {\n            // send request\n            ws.send(JSON.stringify(data));\n        };\n        ws.onerror = (ev: ErrorEvent) => {\n            reject(ev);\n        }\n        ws.onmessage = (ev) => {\n            const msg = JSON.parse(ev.data) as T;\n            resolve(msg);\n            ws.close();\n        }\n    });\n}\n\nexport async function getStackTraceByCrawljax(): Promise<string[]> {\n    const resp = await oneTimeWebSocketRequest(\"ws://localhost:1237\", {\n        type: \"FetchStackTrace\",\n        stack: [],\n    } as StackTraceMessage);\n    return resp.stack;\n}\n\nexport function traceSendAsync(method: string, callback: Function): Function {\n    if ((method === 'eth_sendTransaction' || method === 'eth_sendRawTransaction')) {\n        const traceObj = {stack: undefined};\n        Error.captureStackTrace(traceObj, traceSendAsync);\n        callback = new Proxy(callback, {\n            apply(target, thisArg, argArray) {\n                const trace = {\n                    hash: argArray[1],\n                    stack: traceObj.stack.split(/\\n/).map(item => item.trim()).filter(item => item.length > 0 && item !== \"Error\"),\n                } as SendTransactionTrace;\n                logger.info(\"Transaction trace\", {hash: prettifyHash(trace.hash), stack: trace.stack})\n                const ws = new WebSocket(`ws://localhost:1236`);\n                ws.onopen = () => {\n                    ws.send(JSON.stringify(trace));\n                };\n                ws.onerror = (ev: ErrorEvent) => {\n                    logger.error(\"Send transaction trace error\", {err: ev});\n                }\n                ws.onmessage = () => {\n                    ws.close();\n                }\n                target.apply(thisArg, argArray);\n            },\n        });\n    }\n    return callback;\n}\n\nexport function traceSend(method: string, result: string) {\n    if ((method === 'eth_sendTransaction' || method === 'eth_sendRawTransaction')) {\n        const traceObj = {stack: undefined};\n        Error.captureStackTrace(traceObj, traceSendAsync);\n        const trace = {\n            hash: result,\n            stack: traceObj.stack.split(/\\n/).map(item => item.trim()).filter(item => item.length > 0 && item !== \"Error\"),\n        } as SendTransactionTrace;\n        logger.info(\"Transaction trace\", {hash: prettifyHash(trace.hash), stack: trace.stack});\n        const ws = new WebSocket(`ws://localhost:1236`);\n        ws.onopen = () => {\n            ws.send(JSON.stringify(trace));\n        };\n        ws.onerror = (ev: ErrorEvent) => {\n            logger.error(\"Send transaction trace error\", {err: ev});\n        }\n        ws.onmessage = () => {\n            ws.close();\n        }\n    }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(846);\n"],"sourceRoot":""}